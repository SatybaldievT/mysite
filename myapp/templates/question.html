{% extends 'base.html' %}

{% block content %}
    <div class="question">
        <h1>{{ question.title }}</h1>
        <p>{{ question.description }}</p>
        <div class="question-tags">
            {% for tag in question.tags %}
                <a href="{{ tag.get_absolute_url }}" class="label label-default">{{ tag.name }}</a>
            {% endfor %}
        </div>
    </div>

    <h2>–û—Ç–≤–µ—Ç—ã</h2>
    <form method="post">
        {% csrf_token %}
        <ul id="answers-list" class="list-group">
            {% for answer in answers %}
                <li class="list-group-item">
                    <div class="answer row">
                        <div class="answer-avatar col-md-2">
                            <img src="{{ answer.author.avatar.url }}" alt="–ê–≤–∞—Ç–∞—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∞" class="img-responsive">
                        </div>
                        <div class="answer-info col-md-8">
                            <p>{{ answer.text }}</p>
                        </div>
                        <div class="answer-votes col-md-1 text-center">
                            <button class="btn btn-default upvote" data-answer-id="{{ answer.id }}">üëç</button>
                            <span id="votes-{{ answer.id }}">{{ answer.ratings }}</span>
                        </div>
                        <div class="answer-checkbox col-md-1 text-center">
                            <input type="checkbox" name="selected_answers" value="{{ answer.id }}">
                        </div>
                    </div>
                </li>
            {% endfor %}
        </ul>
    </form>

    {% include 'include/paginator.html' %}

    <h2>–î–æ–±–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç</h2>
    <form method="post">
        {% csrf_token %}
        <div class="form-group">
            <label for="answer-text">–¢–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞:</label>
            <textarea name="answer_text" id="answer-text" class="form-control" rows="3" required></textarea>
        </div>
        <input type="submit" value="–û—Ç–ø—Ä–∞–≤–∏—Ç—å" class="btn btn-primary">
    </form>

    <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ AJAX-–∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É "UPVOTE" –∏–ª–∏ "DOWNVOTE"
        function voteAnswer(answerId, voteType) {
            $.ajax({
                url:  '/'+voteType,
                method: 'POST',
                data: {
                    'answer_id': answerId,
                    'vote_type': voteType,
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },
                success: function(data) {
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ–ª–æ—Å–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
                    $('#votes-' + answerId).text(data.votes);
                }
            });
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–Ω–æ–ø–∫—É "UPVOTE"
        $('.upvote').click(function() {
            var answerId = $(this).data('answer-id');
            voteAnswer(answerId, 'upvote');
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–Ω–æ–ø–∫—É "DOWNVOTE"
        $('.downvote').click(function() {
            var answerId = $(this).data('answer-id');
            voteAnswer(answerId, 'downvote')});
        
    </script>
{% endblock %}